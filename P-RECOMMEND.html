<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>为你推荐 - 小说智阅坊</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#64748b',
                        tertiary: '#059669',
                        success: '#10b981',
                        danger: '#ef4444',
                        info: '#3b82f6',
                        'text-primary': '#1e293b',
                        'text-secondary': '#64748b',
                        'bg-light': '#f8fafc',
                        'border-light': '#e2e8f0'
                    },
                    boxShadow: {
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-collapsed {
            width: 56px;
        }
        
        .sidebar-expanded {
            width: 240px;
        }
        
        .main-content-expanded {
            margin-left: 240px;
        }
        
        .main-content-collapsed {
            margin-left: 56px;
        }
        
        .card-hover:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: translateY(-1px);
            transition: all 0.2s ease-in-out;
        }
        
        .nav-item-active {
            background-color: #dbeafe;
            color: #2563eb;
            border-right: 3px solid #2563eb;
        }
        
        .nav-item:hover {
            background-color: #f1f5f9;
            color: #2563eb;
        }
        
        .search-focus:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .tab-active {
            background-color: #2563eb;
            color: white;
        }
        
        .tab-inactive {
            background-color: #f1f5f9;
            color: #64748b;
        }
        
        .tab-inactive:hover {
            background-color: #e2e8f0;
            color: #2563eb;
        }
        
        .sort-active {
            background-color: #2563eb;
            color: white;
        }
        
        .sort-inactive {
            background-color: #f1f5f9;
            color: #64748b;
        }
        
        .sort-inactive:hover {
            background-color: #e2e8f0;
            color: #2563eb;
        }
    </style>
</head>
<body class="bg-bg-light min-h-screen">
    <!-- 顶部导航栏 -->
    <header id="top-navbar" class="fixed top-0 left-0 right-0 bg-white border-b border-border-light h-16 z-50">
        <div class="flex items-center justify-between h-full px-6">
            <!-- 左侧：Logo和菜单切换 -->
            <div class="flex items-center space-x-4">
                <button id="sidebar-toggle" class="p-2 rounded-lg hover:bg-gray-100 lg:hidden">
                    <i class="fas fa-bars text-gray-600"></i>
                </button>
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
                        <i class="fas fa-book-open text-white text-sm"></i>
                    </div>
                    <h1 class="text-xl font-bold text-text-primary">小说智阅坊</h1>
                </div>
            </div>
            
            <!-- 中间：主导航 -->
            <nav id="main-nav" class="hidden md:flex items-center space-x-8">
                <a href="P-HOME.html" class="text-text-secondary hover:text-primary py-1">首页</a>
                <a href="P-SHELF.html" class="text-text-secondary hover:text-primary py-1">书架</a>
                <a href="P-RECOMMEND.html" class="text-primary font-medium border-b-2 border-primary py-1">推荐</a>
            </nav>
            
            <!-- 右侧：搜索、用户 -->
            <div class="flex items-center space-x-4">
                <div class="relative hidden sm:block">
                    <input type="text" id="global-search" placeholder="搜索小说..." 
                           class="w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg search-focus">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
                <button id="user-menu" class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100">
                    <img src="https://s.coze.cn/image/6EXDC5Jr2hQ/" 
                         alt="用户头像" class="w-8 h-8 rounded-full" data-category="人物">
                    <span class="hidden md:block text-text-primary">读者</span>
                    <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 左侧菜单 -->
    <aside id="sidebar" class="fixed left-0 top-16 bottom-0 bg-white border-r border-border-light sidebar-expanded z-40 transition-all duration-300">
        <nav class="p-4 space-y-2">
            <a href="P-HOME.html" id="nav-home" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary">
                <i class="fas fa-home w-5"></i>
                <span class="sidebar-text">首页</span>
            </a>
            <a href="P-SHELF.html" id="nav-shelf" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary">
                <i class="fas fa-bookmark w-5"></i>
                <span class="sidebar-text">我的书架</span>
            </a>
            <a href="P-RECOMMEND.html" id="nav-recommend" class="nav-item nav-item-active flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium">
                <i class="fas fa-star w-5"></i>
                <span class="sidebar-text">为你推荐</span>
            </a>
            <a href="P-USER_CENTER.html" id="nav-user" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary">
                <i class="fas fa-user w-5"></i>
                <span class="sidebar-text">用户中心</span>
            </a>
            <a href="P-HELP.html" id="nav-help" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-sm font-medium text-text-secondary">
                <i class="fas fa-question-circle w-5"></i>
                <span class="sidebar-text">帮助中心</span>
            </a>
        </nav>
    </aside>

    <!-- 主内容区 -->
    <main id="main-content" class="main-content-expanded pt-16 min-h-screen transition-all duration-300">
        <div class="p-6 max-w-7xl mx-auto">
            <!-- 页面头部 -->
            <div id="page-header" class="mb-8">
                <nav id="breadcrumb" class="text-sm text-text-secondary mb-4">
                    <span>首页</span>
                    <i class="fas fa-chevron-right mx-2"></i>
                    <span class="text-primary">为你推荐</span>
                </nav>
                <h2 class="text-2xl font-bold text-text-primary">为你推荐</h2>
                <p class="text-text-secondary mt-2">基于你的阅读偏好，为你精选优质小说</p>
            </div>

            <!-- 工具栏区域 -->
            <section id="toolbar" class="mb-6">
                <div class="bg-white rounded-xl shadow-card p-4">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                        <!-- 推荐类型切换 -->
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium text-text-primary mr-3">推荐类型：</span>
                            <div class="flex space-x-1" role="tablist">
                                <button id="tab-personal" class="px-4 py-2 text-sm font-medium rounded-lg focus:outline-none tab-active" role="tab" aria-controls="personal-content">
                                    个性化推荐
                                </button>
                                <button id="tab-hot" class="px-4 py-2 text-sm font-medium rounded-lg focus:outline-none tab-inactive" role="tab" aria-controls="hot-content">
                                    热门小说
                                </button>
                                <button id="tab-new" class="px-4 py-2 text-sm font-medium rounded-lg focus:outline-none tab-inactive" role="tab" aria-controls="new-content">
                                    新书速递
                                </button>
                                <button id="tab-category" class="px-4 py-2 text-sm font-medium rounded-lg focus:outline-none tab-inactive" role="tab" aria-controls="category-content">
                                    分类推荐
                                </button>
                            </div>
                        </div>
                        
                        <!-- 筛选和排序 -->
                        <div class="flex items-center space-x-4">
                            <!-- 筛选条件 -->
                            <div class="flex items-center space-x-2">
                                <label for="filter-genre" class="text-sm font-medium text-text-primary">类型：</label>
                                <select id="filter-genre" class="px-3 py-2 border border-gray-300 rounded-lg text-sm search-focus">
                                    <option value="">全部类型</option>
                                    <option value="玄幻">玄幻</option>
                                    <option value="奇幻">奇幻</option>
                                    <option value="仙侠">仙侠</option>
                                    <option value="都市">都市</option>
                                    <option value="历史">历史</option>
                                    <option value="科幻">科幻</option>
                                </select>
                            </div>
                            
                            <div class="flex items-center space-x-2">
                                <label for="filter-author" class="text-sm font-medium text-text-primary">作者：</label>
                                <input type="text" id="filter-author" placeholder="作者名" 
                                       class="px-3 py-2 border border-gray-300 rounded-lg text-sm search-focus w-32">
                            </div>
                            
                            <!-- 排序选项 -->
                            <div class="flex items-center space-x-2">
                                <span class="text-sm font-medium text-text-primary">排序：</span>
                                <div class="flex space-x-1">
                                    <button id="sort-recommend" class="px-3 py-2 text-sm font-medium rounded-lg focus:outline-none sort-active">
                                        推荐度
                                    </button>
                                    <button id="sort-update" class="px-3 py-2 text-sm font-medium rounded-lg focus:outline-none sort-inactive">
                                        更新时间
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 内容展示区域 -->
            <section id="content-area" class="mb-8">
                <div class="bg-white rounded-xl shadow-card overflow-hidden">
                    <div class="overflow-x-auto">
                        <table id="recommend-table" class="w-full">
                            <thead class="bg-gray-50 border-b border-border-light">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">
                                        <input type="checkbox" id="select-all" class="rounded border-gray-300 text-primary focus:ring-primary">
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">封面</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-text-secondary uppercase tracking-wider cursor-pointer hover:text-primary" data-sort="title">
                                        标题 <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-text-secondary uppercase tracking-wider cursor-pointer hover:text-primary" data-sort="author">
                                        作者 <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-text-secondary uppercase tracking-wider cursor-pointer hover:text-primary" data-sort="genre">
                                        类型 <i class="fas fa-sort ml-1"></i>
                                    </th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">简介</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">推荐理由</th>
                                    <th class="px-6 py-4 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody id="recommend-tbody" class="bg-white divide-y divide-border-light">
                                <!-- 动态生成的小说列表 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 分页区域 -->
            <section id="pagination" class="flex items-center justify-between">
                <div class="text-sm text-text-secondary">
                    显示第 <span id="page-start">1</span> - <span id="page-end">10</span> 条，共 <span id="total-count">45</span> 条结果
                </div>
                <div class="flex items-center space-x-2">
                    <button id="prev-page" class="px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50 disabled:opacity-50" disabled>
                        <i class="fas fa-chevron-left"></i> 上一页
                    </button>
                    <div class="flex space-x-1">
                        <button class="page-btn px-3 py-2 border border-primary rounded-lg text-sm font-medium bg-primary text-white">1</button>
                        <button class="page-btn px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50">2</button>
                        <button class="page-btn px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50">3</button>
                        <span class="px-3 py-2 text-sm text-text-secondary">...</span>
                        <button class="page-btn px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50">5</button>
                    </div>
                    <button id="next-page" class="px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-text-secondary hover:bg-gray-50">
                        下一页 <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </section>
        </div>
    </main>

    <!-- 批量操作模态框 -->
    <div id="batch-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-lg font-semibold text-text-primary mb-4">批量操作</h3>
            <p class="text-sm text-text-secondary mb-6">已选择 <span id="selected-count">0</span> 本小说</p>
            <div class="flex space-x-3">
                <button id="batch-add-shelf" class="flex-1 px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-blue-700">
                    批量加入书架
                </button>
                <button id="batch-cancel" class="px-4 py-2 border border-gray-300 text-text-secondary rounded-lg text-sm font-medium hover:bg-gray-50">
                    取消
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 侧边栏切换功能
            const sidebarToggle = document.querySelector('#sidebar-toggle');
            const sidebar = document.querySelector('#sidebar');
            const mainContent = document.querySelector('#main-content');
            const sidebarTexts = document.querySelectorAll('.sidebar-text');
            
            let sidebarCollapsed = false;
            
            sidebarToggle.addEventListener('click', () => {
                sidebarCollapsed = !sidebarCollapsed;
                
                if (sidebarCollapsed) {
                    sidebar.classList.remove('sidebar-expanded');
                    sidebar.classList.add('sidebar-collapsed');
                    mainContent.classList.remove('main-content-expanded');
                    mainContent.classList.add('main-content-collapsed');
                    sidebarTexts.forEach(text => text.style.display = 'none');
                } else {
                    sidebar.classList.remove('sidebar-collapsed');
                    sidebar.classList.add('sidebar-expanded');
                    mainContent.classList.remove('main-content-collapsed');
                    mainContent.classList.add('main-content-expanded');
                    sidebarTexts.forEach(text => text.style.display = 'block');
                }
            });

            // 模拟推荐数据
            const recommendData = {
                personal: [
                    {
                        id: 'novel-1',
                        title: '斗破苍穹',
                        author: '天蚕土豆',
                        genre: '玄幻',
                        cover: 'https://s.coze.cn/image/qKpkxzupBTA/',
                        description: '三十年河东，三十年河西，莫欺少年穷！一个少年的传奇故事，从这里开始...',
                        reason: '根据你的阅读历史，这本小说的风格与你喜欢的作品高度相似'
                    },
                    {
                        id: 'novel-2',
                        title: '完美世界',
                        author: '辰东',
                        genre: '奇幻',
                        cover: 'https://s.coze.cn/image/iDWD_wosgp4/',
                        description: '一粒尘可填海，一根草斩尽日月星辰，弹指间天翻地覆。群雄并起，万族林立，诸圣争霸...',
                        reason: '热门奇幻小说，评分9.2，推荐度高'
                    },
                    {
                        id: 'novel-3',
                        title: '遮天',
                        author: '辰东',
                        genre: '仙侠',
                        cover: 'https://s.coze.cn/image/XHx4j6jYuNU/',
                        description: '冰冷与黑暗并存的宇宙深处，九具庞大的龙尸拉着一口青铜古棺，亘古长存...',
                        reason: '经典仙侠作品，读者口碑极佳'
                    },
                    {
                        id: 'novel-4',
                        title: '全职高手',
                        author: '蝴蝶蓝',
                        genre: '都市',
                        cover: 'https://s.coze.cn/image/i2jAWjZ4o_4/',
                        description: '网游竞技大神叶修的传奇故事，荣耀永不落幕...',
                        reason: '都市竞技类热门作品，适合你的阅读偏好'
                    },
                    {
                        id: 'novel-5',
                        title: '庆余年',
                        author: '猫腻',
                        genre: '历史',
                        cover: 'https://s.coze.cn/image/n2GFagz3nPo/',
                        description: '一个年轻人的成长励志传奇，现代意识与古典情怀的碰撞...',
                        reason: '历史穿越类精品，剧情跌宕起伏'
                    }
                ],
                hot: [
                    {
                        id: 'hot-1',
                        title: '诡秘之主',
                        author: '爱潜水的乌贼',
                        genre: '奇幻',
                        cover: 'https://s.coze.cn/image/K0ggMg-quc4/',
                        description: '蒸汽与机械的时代，谁能触及非凡？历史和黑暗的迷雾里，又是谁在耳语？...',
                        reason: '本周热度榜第1名，读者推荐度9.5'
                    },
                    {
                        id: 'hot-2',
                        title: '牧神记',
                        author: '宅猪',
                        genre: '玄幻',
                        cover: 'https://s.coze.cn/image/Cp064hVRfkE/',
                        description: '大墟的祖训说，天黑，别出门。大墟残老村的老弱病残们从江边捡到了一个婴儿...',
                        reason: '本周热度榜第2名，持续热销'
                    }
                ],
                new: [
                    {
                        id: 'new-1',
                        title: '我真的是大明星',
                        author: '尝谕',
                        genre: '都市',
                        cover: 'https://s.coze.cn/image/EEfxey1cyd8/',
                        description: '十八线小艺人张烨，一朝醒来，发现自己穿越到了一个几乎完全不同的平行世界...',
                        reason: '新书上架，首日点击破万'
                    }
                ],
                category: [
                    {
                        id: 'category-1',
                        title: '三体',
                        author: '刘慈欣',
                        genre: '科幻',
                        cover: 'https://s.coze.cn/image/YT-7qH8NF48/',
                        description: '文化大革命如火如荼的进行，天体物理学家叶文洁历经劫难，被带到军方绝秘计划"红岸工程"...',
                        reason: '科幻分类推荐，经典之作'
                    }
                ]
            };

            let currentTab = 'personal';
            let currentData = recommendData.personal;
            let currentPage = 1;
            let pageSize = 10;
            let selectedNovels = new Set();

            // 渲染小说列表
            function renderNovelList(data) {
                const tbody = document.querySelector('#recommend-tbody');
                tbody.innerHTML = '';

                data.forEach((novel, index) => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <input type="checkbox" class="novel-checkbox rounded border-gray-300 text-primary focus:ring-primary" data-id="${novel.id}">
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <img src="${novel.cover}" alt="${novel.title}封面" class="w-12 h-16 rounded object-cover cursor-pointer" data-category="商业科技" data-id="${novel.id}">
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm font-medium text-text-primary cursor-pointer hover:text-primary novel-title" data-id="${novel.id}">${novel.title}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-text-secondary">${novel.author}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">${novel.genre}</span>
                        </td>
                        <td class="px-6 py-4 text-sm text-text-secondary max-w-xs truncate" title="${novel.description}">
                            ${novel.description.length > 50 ? novel.description.substring(0, 50) + '...' : novel.description}
                        </td>
                        <td class="px-6 py-4 text-sm text-text-secondary max-w-xs truncate" title="${novel.reason}">
                            ${novel.reason}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button class="text-primary hover:text-blue-700 mr-3 start-reading-btn" data-id="${novel.id}">开始阅读</button>
                            <button class="text-text-secondary hover:text-primary add-shelf-btn" data-id="${novel.id}">加入书架</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

                // 绑定事件
                bindNovelEvents();
            }

            // 绑定小说相关事件
            function bindNovelEvents() {
                // 小说标题点击
                document.querySelectorAll('.novel-title').forEach(title => {
                    title.addEventListener('click', function() {
                        const novelId = this.dataset.id;
                        window.location.href = `P-READER.html?novel=${novelId}`;
                    });
                });

                // 小说封面点击
                document.querySelectorAll('img[data-id]').forEach(img => {
                    if (img.classList.contains('cursor-pointer')) {
                        img.addEventListener('click', function() {
                            const novelId = this.dataset.id;
                            window.location.href = `P-READER.html?novel=${novelId}`;
                        });
                    }
                });

                // 开始阅读按钮
                document.querySelectorAll('.start-reading-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const novelId = this.dataset.id;
                        window.location.href = `P-READER.html?novel=${novelId}`;
                    });
                });

                // 加入书架按钮
                document.querySelectorAll('.add-shelf-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const novelId = this.dataset.id;
                        // 模拟加入书架操作
                        this.textContent = '已加入';
                        this.classList.add('text-success');
                        this.classList.remove('text-text-secondary', 'hover:text-primary');
                        
                        // 实际应用中这里会调用API
                        console.log(`小说 ${novelId} 已加入书架`);
                    });
                });

                // 复选框事件
                document.querySelectorAll('.novel-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const novelId = this.dataset.id;
                        if (this.checked) {
                            selectedNovels.add(novelId);
                        } else {
                            selectedNovels.delete(novelId);
                        }
                        updateSelectAllState();
                        updateBatchButton();
                    });
                });
            }

            // 更新全选状态
            function updateSelectAllState() {
                const selectAll = document.querySelector('#select-all');
                const checkboxes = document.querySelectorAll('.novel-checkbox');
                const checkedCount = document.querySelectorAll('.novel-checkbox:checked').length;
                
                if (checkedCount === 0) {
                    selectAll.indeterminate = false;
                    selectAll.checked = false;
                } else if (checkedCount === checkboxes.length) {
                    selectAll.indeterminate = false;
                    selectAll.checked = true;
                } else {
                    selectAll.indeterminate = true;
                    selectAll.checked = false;
                }
            }

            // 更新批量操作按钮状态
            function updateBatchButton() {
                const batchModal = document.querySelector('#batch-modal');
                const selectedCount = document.querySelector('#selected-count');
                
                if (selectedNovels.size > 0) {
                    selectedCount.textContent = selectedNovels.size;
                }
            }

            // 全选/取消全选
            document.querySelector('#select-all').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.novel-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                    const novelId = checkbox.dataset.id;
                    if (this.checked) {
                        selectedNovels.add(novelId);
                    } else {
                        selectedNovels.delete(novelId);
                    }
                });
                updateBatchButton();
            });

            // 标签页切换
            const tabs = document.querySelectorAll('[role="tab"]');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // 隐藏所有内容
                    tabs.forEach(t => {
                        t.classList.remove('tab-active');
                        t.classList.add('tab-inactive');
                    });
                    
                    // 激活当前标签
                    this.classList.remove('tab-inactive');
                    this.classList.add('tab-active');
                    
                    // 更新当前标签
                    currentTab = this.id.replace('tab-', '');
                    currentData = recommendData[currentTab] || [];
                    currentPage = 1;
                    selectedNovels.clear();
                    
                    // 渲染数据
                    renderNovelList(currentData);
                    updateSelectAllState();
                    updateBatchButton();
                });
            });

            // 筛选功能
            document.querySelector('#filter-genre').addEventListener('change', function() {
                applyFilters();
            });

            document.querySelector('#filter-author').addEventListener('input', function() {
                applyFilters();
            });

            function applyFilters() {
                const genre = document.querySelector('#filter-genre').value;
                const author = document.querySelector('#filter-author').value.toLowerCase();
                
                let filteredData = recommendData[currentTab] || [];
                
                if (genre) {
                    filteredData = filteredData.filter(novel => novel.genre === genre);
                }
                
                if (author) {
                    filteredData = filteredData.filter(novel => novel.author.toLowerCase().includes(author));
                }
                
                renderNovelList(filteredData);
            }

            // 排序功能
            const sortButtons = document.querySelectorAll('[id^="sort-"]');
            sortButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // 重置所有排序按钮样式
                    sortButtons.forEach(btn => {
                        btn.classList.remove('sort-active');
                        btn.classList.add('sort-inactive');
                    });
                    
                    // 激活当前按钮
                    this.classList.remove('sort-inactive');
                    this.classList.add('sort-active');
                    
                    // 执行排序
                    const sortType = this.id.replace('sort-', '');
                    sortData(sortType);
                });
            });

            function sortData(type) {
                let sortedData = [...currentData];
                
                switch(type) {
                    case 'recommend':
                        // 保持原顺序（推荐度排序）
                        break;
                    case 'update':
                        // 模拟按更新时间排序
                        sortedData.reverse();
                        break;
                    default:
                        break;
                }
                
                renderNovelList(sortedData);
            }

            // 表格排序
            document.querySelectorAll('[data-sort]').forEach(header => {
                header.addEventListener('click', function() {
                    const sortField = this.dataset.sort;
                    sortTable(sortField);
                });
            });

            function sortTable(field) {
                let sortedData = [...currentData];
                
                sortedData.sort((a, b) => {
                    if (a[field] < b[field]) return -1;
                    if (a[field] > b[field]) return 1;
                    return 0;
                });
                
                renderNovelList(sortedData);
            }

            // 分页功能
            document.querySelectorAll('.page-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = parseInt(this.textContent);
                    if (page) {
                        currentPage = page;
                        updatePagination();
                    }
                });
            });

            document.querySelector('#prev-page').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    updatePagination();
                }
            });

            document.querySelector('#next-page').addEventListener('click', function() {
                const totalPages = Math.ceil(currentData.length / pageSize);
                if (currentPage < totalPages) {
                    currentPage++;
                    updatePagination();
                }
            });

            function updatePagination() {
                const start = (currentPage - 1) * pageSize + 1;
                const end = Math.min(currentPage * pageSize, currentData.length);
                
                document.querySelector('#page-start').textContent = start;
                document.querySelector('#page-end').textContent = end;
                document.querySelector('#total-count').textContent = currentData.length;
                
                // 更新分页按钮状态
                document.querySelectorAll('.page-btn').forEach(btn => {
                    const page = parseInt(btn.textContent);
                    if (page === currentPage) {
                        btn.classList.remove('border-gray-300', 'text-text-secondary', 'hover:bg-gray-50');
                        btn.classList.add('border-primary', 'bg-primary', 'text-white');
                    } else {
                        btn.classList.remove('border-primary', 'bg-primary', 'text-white');
                        btn.classList.add('border-gray-300', 'text-text-secondary', 'hover:bg-gray-50');
                    }
                });
                
                // 更新上一页/下一页按钮状态
                document.querySelector('#prev-page').disabled = currentPage === 1;
                const totalPages = Math.ceil(currentData.length / pageSize);
                document.querySelector('#next-page').disabled = currentPage === totalPages;
            }

            // 批量操作模态框
            document.querySelector('#batch-add-shelf').addEventListener('click', function() {
                if (selectedNovels.size > 0) {
                    // 模拟批量加入书架
                    console.log(`批量加入书架: ${Array.from(selectedNovels).join(', ')}`);
                    
                    // 关闭模态框
                    document.querySelector('#batch-modal').classList.add('hidden');
                    
                    // 重置选择状态
                    selectedNovels.clear();
                    document.querySelectorAll('.novel-checkbox').forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    updateSelectAllState();
                    
                    // 显示成功提示
                    alert('批量加入书架成功！');
                }
            });

            document.querySelector('#batch-cancel').addEventListener('click', function() {
                document.querySelector('#batch-modal').classList.add('hidden');
            });

            // 点击模态框背景关闭
            document.querySelector('#batch-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });

            // 搜索功能
            document.querySelector('#global-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const keyword = e.target.value.trim();
                    if (keyword) {
                        window.location.href = `P-SEARCH_RESULT.html?q=${encodeURIComponent(keyword)}`;
                    }
                }
            });

            // 导航菜单点击事件
            document.querySelector('#nav-home').addEventListener('click', function() {
                window.location.href = 'P-HOME.html';
            });

            document.querySelector('#nav-shelf').addEventListener('click', function() {
                window.location.href = 'P-SHELF.html';
            });

            document.querySelector('#nav-recommend').addEventListener('click', function() {
                // 已在推荐页面，无需操作
            });

            document.querySelector('#nav-user').addEventListener('click', function() {
                window.location.href = 'P-USER_CENTER.html';
            });

            document.querySelector('#nav-help').addEventListener('click', function() {
                window.location.href = 'P-HELP.html';
            });

            // 响应式处理
            function handleResize() {
                if (window.innerWidth < 1024) {
                    sidebar.style.transform = sidebarCollapsed ? 'translateX(0)' : 'translateX(0)';
                } else {
                    sidebar.style.transform = 'translateX(0)';
                }
            }

            window.addEventListener('resize', handleResize);
            handleResize(); // 初始化

            // 初始化页面
            renderNovelList(currentData);
            updatePagination();
        });
    </script>

    <!-- 版权信息 -->
    <footer class="bg-white border-t border-border-light py-6">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex flex-col items-center space-y-4">
                <div class="flex items-center space-x-3">
                    <img src="logo.png" alt="小说智阅坊" class="w-8 h-8">
                    <span class="text-sm text-text-secondary">上海大学 25121385 于承樟</span>
                </div>
                <p class="text-xs text-text-secondary">© 2024 小说智阅坊 - 智能阅读平台</p>
            </div>
        </div>
    </footer>
</body>
</html>